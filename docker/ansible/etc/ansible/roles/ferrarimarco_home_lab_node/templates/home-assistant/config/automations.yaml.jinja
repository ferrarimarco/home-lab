#jinja2:variable_start_string:'[%', variable_end_string:'%]'
---
- id: frigate_event_notify
  alias: Notify on Frigate events
  description: Notify when a Frigate event occurs
  trigger:
    - platform: mqtt
      topic: frigate/events
  action:
    - service: telegram_bot.send_photo
      data:
        url: >-
          http://[% frigate_http_endpoint_fqdn %]:[% frigate_host_port %]/api/events/{{trigger.payload_json["after"]["id"]}}/snapshot.jpg
        caption: >-
          A {{trigger.payload_json["after"]["label"]}} was detected. Here is a snapshot of the event.
        message_tag: >-
          {{trigger.payload_json["after"]["id"]}}
    - service: telegram_bot.send_video
      data:
        url: >-
          http://[% frigate_http_endpoint_fqdn %]:[% frigate_host_port %]/api/events/{{trigger.payload_json["after"]["id"]}}/clip.mp4
        caption: >-
          A {{trigger.payload_json["after"]["label"]}} was detected. Here is a recording of the event.
        message_tag: >-
          {{trigger.payload_json["after"]["id"]}}
  mode: queued
- id: send_notification_home_assistant_update
  alias: Send a notification when a Home Assistant update is available
  description: Send a notification when a Home Assistant update is available
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.docker_hub_update_available
      to: "on"
  condition: []
  action:
    - service: telegram_bot.send_message
      data:
        message: >-
          There is a Home Assistant update available. Current version: {{
          states('sensor.current_version') }}. Docker Hub version: {{
          states('sensor.docker_hub') }}
  mode: single
- id: '1672339316110'
  alias: Lavatrice
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.presa_lavatrice_power
    below: 10
  condition: []
  action:
  - service: telegram_bot.send_message
    data:
      message: La lavatrice ha terminato il ciclo di lavaggio
  mode: single
...
