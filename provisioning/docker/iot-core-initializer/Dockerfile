FROM alpine:3.12

RUN apk add --update \
    openssl

ARG IOT_CORE_CONFIGURATION_DIRECTORY_PATH="/etc/cloud-iot-core"
ENV IOT_CORE_CONFIGURATION_DIRECTORY_PATH="${IOT_CORE_CONFIGURATION_DIRECTORY_PATH}"
ENV IOT_CORE_KEYS_DIRECTORY_PATH="${IOT_CORE_CONFIGURATION_DIRECTORY_PATH}/keys"
ENV IOT_CORE_KEYS_PRIVATE_KEY_PATH="${IOT_CORE_KEYS_DIRECTORY_PATH}/private_key.pem" \
    IOT_CORE_KEYS_PUBLIC_KEY_PATH="${IOT_CORE_KEYS_DIRECTORY_PATH}/public_key.pem"

ARG CONFIGURATION_DIRECTORY_PATH
COPY "$CONFIGURATION_DIRECTORY_PATH"/ /

VOLUME ["${IOT_CORE_CONFIGURATION_DIRECTORY_PATH}"]

RUN chmod a+x /docker-entrypoint.sh
ENTRYPOINT ["/docker-entrypoint.sh"]
